<app-titles-subtitles   [title]="'Analizar reporte'"
                        [subtitle]="'Evaluá cada parametro para generar un informe completo.'">
</app-titles-subtitles>
<form [formGroup]="measurementsForm">

<div class="card flex justify-center mt-6">
    <p-stepper [value]="1" class="w-full max-w-6xl">
        <p-step-list>
            <p-step [value]="1">Tensión</p-step>
            <p-step [value]="2">Temperatura</p-step>
            <p-step [value]="3">Densidad</p-step>
            <p-step [value]="4">Resistencia</p-step>
            <p-step [value]="5">CCA</p-step>
            <p-step [value]="6">Enviar reporte</p-step>
        </p-step-list>
        <p-step-panels>
            <p-step-panel [value]="1">
                <ng-template #content let-activateCallback="activateCallback">
                    <div class="flex flex-col gap-6 min-h-[500px]">
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Gráfico de Tensión</h3>
                            <div class="flex justify-center items-center">
                                <app-report-chart [magnitude]="'tension'"></app-report-chart>
                            </div>
                        </div>
                        <app-stepper-actions [currentStep]="1" [totalSteps]="6" [activateCallback]="activateCallback" [group]="measurementsForm.get('tension')" (submitForm)="onSubmitFinal()"></app-stepper-actions>
                    </div>
                </ng-template>
            </p-step-panel>

            <p-step-panel [value]="2">
                <ng-template #content let-activateCallback="activateCallback">
                    <div class="flex flex-col gap-6 min-h-[500px]">
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Gráfico de Temperatura</h3>
                            <div class="flex justify-center items-center">
                                <app-report-chart [magnitude]="'temperatura'"></app-report-chart>
                            </div>
                        </div>
                        <app-stepper-actions [currentStep]="2" [totalSteps]="6" [activateCallback]="activateCallback" [group]="measurementsForm.get('temperatura')" (submitForm)="onSubmitFinal()"></app-stepper-actions>
                    </div>
                </ng-template>
            </p-step-panel>

            <p-step-panel [value]="3">
                <ng-template #content let-activateCallback="activateCallback">
                    <div class="flex flex-col gap-6 min-h-[500px]">
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Gráfico de Densidad</h3>
                            <div class="flex justify-center items-center">
                                <app-report-chart [magnitude]="'densidad'"></app-report-chart>
                            </div>
                        </div>
                        <app-stepper-actions [currentStep]="3" [totalSteps]="6" [activateCallback]="activateCallback" [group]="measurementsForm.get('densidad')" (submitForm)="onSubmitFinal()"></app-stepper-actions>
                    </div>
                </ng-template>
            </p-step-panel>

            <p-step-panel [value]="4">
                <ng-template #content let-activateCallback="activateCallback">
                    <div class="flex flex-col gap-6 min-h-[500px]">
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Gráfico de Resistencia</h3>
                            <div class="flex justify-center items-center">
                                <app-report-chart [magnitude]="'resistencia'"></app-report-chart>
                            </div>
                        </div>
                        <app-stepper-actions [currentStep]="4" [totalSteps]="6" [activateCallback]="activateCallback" [group]="measurementsForm.get('resistencia')" (submitForm)="onSubmitFinal()"></app-stepper-actions>
                    </div>
                </ng-template>
            </p-step-panel>

            <p-step-panel [value]="5">
                <ng-template #content let-activateCallback="activateCallback">
                    <div class="flex flex-col gap-6 min-h-[500px]">
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Gráfico de CCA</h3>
                            <div class="flex justify-center items-center">
                                <app-report-chart [magnitude]="'cca'"></app-report-chart>
                            </div>
                        </div>
                        <app-stepper-actions [currentStep]="5" [totalSteps]="6" [activateCallback]="activateCallback" [group]="measurementsForm.get('cca')" (submitForm)="onSubmitFinal()"></app-stepper-actions>
                    </div>
                </ng-template>
            </p-step-panel>


            <p-step-panel [value]="6">
                <ng-template #content let-activateCallback="activateCallback">
                    <div class="flex flex-col gap-6 min-h-[500px]">
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Vista previa del reporte</h3>
                            <div class="border border-gray-200 rounded-lg overflow-hidden">
                                <table class="w-full">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Parámetro</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr *ngFor="let param of getPreviewData()" class="hover:bg-gray-50">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900">{{ param.nombre }}</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full"
                                                      [ngClass]="{
                                                        'bg-green-100 text-green-800': param.estado === 'Aprobado',
                                                        'bg-red-100 text-red-800': param.estado === 'Desaprobado'
                                                      }">
                                                    {{ param.estado }}
                                                </span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <app-stepper-actions [currentStep]="6" [totalSteps]="6" [activateCallback]="activateCallback" [isLast]="true" (submitForm)="onSubmitFinal()"></app-stepper-actions>
                    </div>
                </ng-template>
            </p-step-panel>

            
        </p-step-panels>
    </p-stepper>
</div>

</form>
